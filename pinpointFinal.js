/* 

Pinpoint Error Manager is new framework/library for debugging JavaScript Web Applications You simply add this library to your source code and it bisplays javascript bugs in a simple, easy to undrstand interface.
Copyright 2020 by PJ Dahill

License forthcoming. Currently all rights are reserved, You may distrubute Pinpoint and use it free of charge, for non-commercial use or educational purposes. 

Commercial usage is also free of change however requires basic written permission (such as an email) from the author/creator stating you have authorization. All other right remain reserved.

patrick.dahill@gmail.com

http://www.pjdahill.com

*/


errorManager=function () {var errorString="";var errorObj;var htmlDisplay="";var mountInBody=function (inObj) {document.body.appendChild(inObj);};var loadFileFromServer=function (infile) {var request=new XMLHttpRequest();request.open('GET', infile, false);request.send(null);if (request.status===200) {var returnData=request.responseText;return returnData;};};var specificType=function (invar) {retval=typeof invar;if (retval !='object') {return retval;} else {if (invar===null) {return "null";};if (JSON.stringify(invar)[0]=="{") {return "object";} else {return "array";};};};var demarkupCode=function(inString){var lclObj=document.createElement("span");lclObj.innerText=inString;var retval=lclObj.innerHTML;return retval;}; window.onerror=function (errorMsg, url, lineNumber, colno, err) {managePageError(errorMsg, url, lineNumber, colno, err);};var managePageError=function(errorMsg, url, lineNumber, colno, err){errorMsg=demarkupCode(errorMsg);const docTitle=document.title;function buildPinpointInterface(){var returnObject;const getVirtualDomString=function(){var retval;retval=`{"tag":"div","content":[{"tag":"div","content":[{"tag":"style","content":" body,html{ height: 99%;} .lineContainer { background-color: #000000;color: #00ff00;position: relative;font-size: 12px;} .numberBox { width: 60px;font-size: 12px;text-align: right;padding-right: 4px;position: absolute;top: 0px;left: 0px;} .contentBox { padding-right: 3px;padding-left: 0px;} .contentDiv { margin-left: 70px;padding-left: 3px;border-style: solid;border-color: #ffffff;border-width: 0px;border-left-width: 1px;} td.listReadout{ border-style: solid;padding: 3px;font-family: Verdana, Geneva, Tahoma, sans-serif;font-size: 12px;background-color: #ffffff;} "},{"tag":"table","attributes":{"border":"0","cellpadding":"0","cellspacing":"0","style":"width: 90%;margin: auto;height: 100%;max-width: 1024px;"},"content":[{"tag":"tbody","content":[{"tag":"tr","content":[{"tag":"td","attributes":{"valign":"top"},"content":[{"tag":"text","content":" "},{"tag":"div","attributes":{"style":"font-size: 26px;font-family: arial;background-color: #e8e8e8;padding: 2px;"},"content":"Pinpoint Error Manager"},{"tag":"div","attributes":{"style":"font-family: arial;color: red;font-size: 14px;margin-bottom: 18px;padding-left: 2px;"},"content":[{"tag":"text","content":"JavaScript coding error in '"},{"tag":"span","attributes":{"id":"pageTitle"},"content":""},{"tag":"span", "content":"'"}]},{"tag":"div","attributes":{"id":"errorListing","style":"background-color: #f0f0f0;padding: 8px;border-style: solid;border-color: #000000;border-width: 1px;font-family: arial;font-size: 13px;color: #000040"},"content":""},{"tag":"div","attributes":{"style":"height: 24px;"},"content":"&nbsp;"}]}]}]}]},{"tag":"text","content":" "},{"tag":"table","attributes":{"style":"width: 90%;height: 100%;margin: auto;","border":"0","cellpadding":"0","cellspacing":"0"},"content":[{"tag":"tbody","content":[{"tag":"tr","content":[{"tag":"td","attributes":{"class":"listReadout","id":"javascriptTab","style":"width: 25%;border-width:1px;border-bottom-width: 0px;border-right-width: 0px;background-color: #ffffff;cursor: default;"},"content":"Javascript Code"},{"tag":"td","attributes":{"class":"listReadout","id":"htmlTab","style":"width: 25%;border-width:1px;border-bottom-width:1px;border-left-width: 1px;background-color: #e8e8e8;cursor: pointer;"},"content":"Generated HTML"},{"tag":"td","attributes":{"class":"listReadout","id":"layoutTab","style":"width: 25%;border-width:1px;border-bottom-width:1px;border-left-width: 0px;background-color: #e8e8e8;cursor: pointer;"},"content":"Page Layout"},{"tag":"td","attributes":{"class":"listReadout","style":"width: 25%;border-width:0px;border-bottom-width:1px;border-left-width: 0px;background-color: #ffffff;cursor: pointer;"},"content":"&nbsp;"}]},{"tag":"tr","content":[{"tag":"td","attributes":{"class":"listReadout","colspan":"4","style":"width: 100%;border-width: 0px 1px 1px 1px;"},"content":[{"tag":"div","attributes":{"id":"javascriptCode","style":"font-family: courier;height: 420px;overflow-y: auto;overflow-x: hidden;border-style: solid;border-color: #000000;border-width: 1px;padding: 4px;font-size: 12px;font-weight: bold;color: #20c000;background-color: #000000;"},"content":""},{"tag":"div","attributes":{"id":"htmlResult","style":"font-family: courier;height: 420px;overflow-y: auto;overflow-x: hidden;border-style: solid;border-color: #000000;border-width: 1px;padding: 4px;font-size: 12px;font-weight: bold;color: #20c000;background-color: #000000;display: none;"},"content":""},{"tag":"div","attributes":{"id":"pageLayout","style":"height: 420px;overflow: hidden;border-style: solid;border-color: #000000;border-width: 1px;padding: 4px;font-size: 12px;font-weight: bold;background-color: #ffffff;display: none;"},"content":" "}]}]},{"tag":"tr","content":[{"tag":"td","content":" "}]}]}]}]},{"tag":"div","attributes":{"style":"font-family: arial;color: black;font-size: 12px;text-align: center;width: 100%;background-color: #ffffff;position: absolute;left: 0px;bottom: 0px;text-align: center;padding-bottom: 6px;"},"content":"Copyright 2021 by PJ Dahill All rights reserved."}]}`;return retval;};var composeElement=function(cMap) {const buildElement=document.createElement(cMap.tag);for (const key in cMap.attributes) {buildElement.setAttribute(key, cMap.attributes[key]);};var manageElementChildren=function(cMap, container) {var buildElement;var key;var i;var fetchObj;
;buildElement=document.createElement(cMap.tag);for (key in cMap.attributes) {buildElement.setAttribute(key, cMap.attributes[key]);};if (typeof cMap.content==='string') {buildElement.innerHTML=cMap.content;} else {for(i=0;i < cMap.content.length;i++){fetchObj=cMap.content[i];manageElementChildren(fetchObj, buildElement);};};var fetchDog=buildElement.tagName.toLowerCase();if(fetchDog=="text"){container.append(buildElement.innerText);}else{container.appendChild(buildElement);};};if (typeof cMap.content==='string') {buildElement.innerHTML=cMap.content;} else {for(var j=0;j < cMap.content.length;j++){var fetchObj=cMap.content[j];manageElementChildren(fetchObj, buildElement);};};return parseDynamicElements(buildElement);};var parseDynamicElements=function (parentComponent) {var myChildList=parentComponent.querySelectorAll("*");for (var i=0;i < myChildList.length;i++) {var item=myChildList[i];if (item.hasAttribute("id")) {var blip=item.querySelectorAll("*");var lclId=item.getAttribute("id");item.setHTML=function (inval) {this.innerHTML=inval;};item.setText=function(inval){this.innerText=inval;};item.appendNode=function (inval) {this.appendChild(inval);};item.getHTML=function () {var retval=this.innerHTML;return retval;};item.setText=function (inval) {this.innerText=inval;};item.getText=function () {var retval=this.innerText;return retval;};parentComponent[lclId]=item;item.removeAttribute("id");};};return parentComponent;};returnObject=composeElement(JSON.parse(getVirtualDomString()));return returnObject;};errorMsg=demarkupCode(errorMsg);if(errorMsg.indexOf("--lmnError")==-1){errorString=errorString + errorMsg + " at line: " + lineNumber + "<br /><br />" + url + "<br/>";};let errNode=document.createElement("div");errNode.innerHTML="<b>" + errorMsg + " at line: " + lineNumber + "</b>";procHTML=document.documentElement;childList=procHTML.querySelectorAll("body");var currentNode=childList[0];currentNode.appendChild(errNode);htmlDisplay=procHTML.outerHTML;childList=procHTML.querySelectorAll("*");for(var i=0;i < childList.length;i++){var currentNode=childList[i];if(currentNode.tagName.toLowerCase()=="script"){currentNode.remove();};};var lclHTMLString=procHTML.outerHTML;document.documentElement.innerHTML="";document.body.innerHTML="";errorObj=buildPinpointInterface();errorObj.errorListing.setHTML(errorString);var javacode=String.raw`${loadFileFromServer(url)}`;javacode=listProgramCode(javacode);errorObj.javascriptCode.setHTML(javacode);errorObj.pageTitle.setHTML(docTitle);errorObj.htmlResult.setText(htmlDisplay);myIframe=document.createElement("iframe");myIframe.style="width: 100%;margin: 0px;border: 0px;height: 100%;";myIframe.srcdoc=lclHTMLString;errorObj.pageLayout.append(myIframe);errorObj.javascriptTab.addEventListener("click", function () {if (this.style.cursor=="pointer") {errorObj.javascriptTab.style="width: 25%;border-width: 1px;border-bottom-width:0px;background-color: #ffffff;cursor: default;";errorObj.htmlTab.style="width: 25%;border-width: 1px;border-left-width: 0px;border-bottom-width:1px;background-color: #e8e8e8;cursor: pointer;";errorObj.layoutTab.style="width: 25%;border-width: 1px;border-left-width: 0px;border-bottom-width:1px;background-color: #e8e8e8;cursor: pointer;";errorObj.htmlResult.style.display="none";errorObj.pageLayout.style.display="none";errorObj.javascriptCode.style.display="block";};});errorObj.htmlTab.addEventListener("click", function () {if (this.style.cursor=="pointer") {errorObj.javascriptTab.style="width: 25%;border-width: 1px;border-bottom-width: 1px;background-color: #e8e8e8;cursor: pointer;";errorObj.layoutTab.style="width: 25%;border-width: 1px;border-left-width: 0px;border-bottom-width: 1px;background-color: #e8e8e8;cursor: pointer;";errorObj.htmlTab.style="width: 25%;border-width: 1px;border-left-width: 0px;border-bottom-width:0px;background-color: #ffffff;cursor: default;";errorObj.htmlResult.style.display="block";errorObj.javascriptCode.style.display="none";errorObj.pageLayout.style.display="none";};});errorObj.layoutTab.addEventListener("click", function () {if (this.style.cursor=="pointer") {errorObj.javascriptTab.style="width: 25%;border-width: 1px;border-bottom-width: 1px;background-color: #e8e8e8;cursor: pointer;";errorObj.htmlTab.style="width: 25%;border-width: 1px;border-left-width: 0px;border-bottom-width:1px;background-color: #e8e8e8;cursor: pointer;";errorObj.layoutTab.style="width: 25%;border-width: 1px;border-left-width: 0px;border-bottom-width:0px;background-color: #ffffff;cursor: default;";errorObj.htmlResult.style.display="none";errorObj.javascriptCode.style.display="none";errorObj.pageLayout.style.display="block";};});mountInBody(errorObj);};var listProgramCode=function(displayCode){var indentCount=0;var retval="";let codeLineArray=displayCode.split("\n");codeLineArray.forEach(function (item, index) {var myIndex=index + 1;displayLineRow=function (content, lineNumber) {for (var i=0;i < content.length;i++) {var lclPadding=3 + (indentCount * 8);if (content[i]=="{") {indentCount++;};if (content[i]=="}") {indentCount--;};};content=content.replace(/</g, "&lt;");content=content.replace(/>/g, "&gt;");retval=`<div class="lineContainer"><div class="contentBox"><div class="contentDiv" style="padding-left: ${lclPadding}px">${content}&nbsp;</div></div><div class="numberBox">${lineNumber}:</div></div>`;return retval;};retval=retval + this.displayLineRow(item, myIndex);});return retval;}};lclErrMgr=new errorManager();
